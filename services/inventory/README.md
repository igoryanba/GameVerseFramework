# Микросервис инвентаря GameVerse Framework

Микросервис инвентаря предоставляет функциональность для управления инвентарями и предметами в игровом мире GameVerse Framework.

## Возможности

- Создание и управление инвентарями различных типов (игрок, транспорт, контейнер, магазин)
- Управление предметами внутри инвентарей
- Поддержка стекирования предметов
- Перемещение предметов между инвентарями
- Управление прочностью (durability) предметов
- Система шаблонов предметов с различными характеристиками
- Категоризация предметов
- Пользовательские метаданные для предметов и инвентарей
- Доступ через gRPC и REST API

## Архитектура

Микросервис использует следующие технологии:

- **Rust** в качестве основного языка программирования
- **Tokio** для асинхронной работы
- **gRPC** для коммуникации между сервисами
- **REST API** (Axum) для веб-доступа
- **PostgreSQL** для хранения данных
- **Redis** для кэширования
- **SQLx** для работы с базой данных
- **Tonic** для реализации gRPC
- **Axum** для REST API

### Структура проекта

```
services/inventory/
├── Cargo.toml               # Зависимости проекта
├── build.rs                 # Компиляция proto файлов
├── docker-compose.yml       # Конфигурация Docker для разработки
├── migrations/              # Миграции базы данных
├── proto/                   # Определения gRPC API
├── scripts/                 # Скрипты для разработки и деплоя
├── src/
│   ├── config.rs            # Конфигурация сервиса
│   ├── grpc/                # Реализация gRPC сервера
│   ├── lib.rs               # Публичное API библиотеки
│   ├── main.rs              # Точка входа сервиса
│   ├── models/              # Модели данных
│   ├── proto/               # Сгенерированный код из proto файлов
│   ├── repositories/        # Репозитории для работы с данными
│   └── services/            # Бизнес-логика
└── examples/                # Примеры использования
```

## Разработка

### Настройка окружения

1. Установите Rust и Cargo: https://rustup.rs/
2. Установите Docker и Docker Compose
3. Клонируйте репозиторий

### Запуск в режиме разработки

```bash
# Запуск PostgreSQL, Redis и других зависимостей
./scripts/dev.sh
```

### Запуск тестов

```bash
cargo test
```

### Использование API

Для работы с API микросервиса инвентаря можно использовать gRPC или REST API.

#### gRPC API

Микросервис предоставляет следующие gRPC методы:

- `GetInventory` - Получение информации об инвентаре
- `GetInventoryItems` - Получение предметов в инвентаре
- `AddItem` - Добавление предмета в инвентарь
- `RemoveItem` - Удаление предмета из инвентаря
- `MoveItem` - Перемещение предмета между инвентарями
- `UpdateItem` - Обновление информации о предмете
- `CraftItem` - Крафт предмета (в разработке)
- `UseItem` - Использование предмета (в разработке)
- `GetItemTemplates` - Получение шаблонов предметов

#### REST API

Микросервис также предоставляет REST API для удобного взаимодействия:

**Инвентари:**
- `GET /inventories` - Получение списка инвентарей
- `POST /inventories` - Создание нового инвентаря
- `GET /inventories/:id` - Получение информации об инвентаре
- `PUT /inventories/:id` - Обновление инвентаря
- `DELETE /inventories/:id` - Удаление инвентаря
- `GET /owners/:owner_type/:owner_id/inventories` - Получение инвентарей владельца

**Предметы:**
- `GET /inventories/:id/items` - Получение всех предметов в инвентаре
- `POST /inventories/:id/items` - Добавление предмета в инвентарь
- `GET /items/:id` - Получение информации о предмете
- `PUT /items/:id` - Обновление предмета
- `DELETE /items/:id` - Удаление предмета
- `POST /items/:id/move/:target_inventory_id` - Перемещение предмета
- `POST /items/:id/split` - Разделение стака предметов
- `POST /items/:source_id/stack/:target_id` - Стакирование предметов

**Шаблоны предметов:**
- `GET /templates` - Получение списка шаблонов предметов
- `POST /templates` - Создание нового шаблона предмета
- `GET /templates/:id` - Получение информации о шаблоне
- `PUT /templates/:id` - Обновление шаблона предмета
- `DELETE /templates/:id` - Удаление шаблона предмета

Примеры использования API находятся в директории `examples/`.

## API

### gRPC API

Микросервис предоставляет следующие gRPC методы:

- `GetInventory` - Получение информации об инвентаре
- `GetInventoryItems` - Получение предметов в инвентаре
- `AddItem` - Добавление предмета в инвентарь
- `RemoveItem` - Удаление предмета из инвентаря
- `MoveItem` - Перемещение предмета между инвентарями
- `UpdateItem` - Обновление информации о предмете
- `CraftItem` - Крафт предмета (в разработке)
- `UseItem` - Использование предмета (в разработке)
- `GetItemTemplates` - Получение шаблонов предметов

## Модели данных

### Инвентарь

Инвентарь представляет собой контейнер для предметов, который может принадлежать игроку, транспорту, объекту и т.д.

Поля:
- `id` - Уникальный идентификатор инвентаря
- `owner_id` - Идентификатор владельца
- `owner_type` - Тип владельца (player, vehicle, container, ...)
- `inventory_type` - Тип инвентаря (player, vehicle, container, shop, temp)
- `max_weight` - Максимальный вес, который может содержать инвентарь
- `max_slots` - Максимальное количество слотов
- `name` - Название инвентаря
- `metadata` - Дополнительные метаданные

### Предмет

Предмет представляет конкретный экземпляр предмета в инвентаре.

Поля:
- `id` - Уникальный идентификатор предмета
- `inventory_id` - Идентификатор инвентаря, которому принадлежит предмет
- `template_id` - Идентификатор шаблона предмета
- `position` - Позиция предмета в инвентаре (номер слота)
- `quantity` - Количество предметов в стаке
- `durability` - Текущая прочность предмета
- `metadata` - Дополнительные метаданные предмета

### Шаблон предмета

Шаблон предмета описывает тип предмета и его базовые характеристики.

Поля:
- `id` - Уникальный идентификатор шаблона
- `name` - Название предмета
- `description` - Описание предмета
- `weight` - Вес предмета
- `stackable` - Можно ли складывать предметы в стак
- `max_stack` - Максимальный размер стака
- `max_durability` - Максимальная прочность предмета
- `icon` - Иконка предмета
- `category` - Категория предмета
- `properties` - Дополнительные свойства предмета

## Итоги разработки

В ходе реализации микросервиса инвентаря были выполнены следующие задачи:

1. **Моделирование данных**:
   - Разработаны модели для инвентарей, предметов и шаблонов предметов
   - Реализована поддержка метаданных для всех типов сущностей
   - Созданы SQL-миграции для инициализации базы данных

2. **Доступ к данным**:
   - Реализованы репозитории для работы с PostgreSQL
   - Использован SQLx для типобезопасных SQL-запросов
   - Настроена обработка ошибок и транзакции

3. **Бизнес-логика**:
   - Реализована логика управления инвентарями и предметами
   - Настроена валидация данных
   - Реализованы операции стекирования и разделения предметов
   - Добавлена поддержка перемещения предметов между инвентарями

4. **Интеграция**:
   - Определен gRPC API через proto файлы
   - Реализован gRPC сервер для обработки запросов
   - Создан клиент для тестирования API

5. **Инфраструктура**:
   - Настроен Docker Compose для локальной разработки
   - Добавлены скрипты для управления окружением
   - Интегрирован сервис логирования

### Дальнейшие планы

1. Реализация REST API для управления инвентарем
2. Интеграция с микросервисом данных игроков
3. Разработка системы крафтинга предметов
4. Реализация механики использования предметов
5. Добавление интеграционных тестов
6. Мониторинг производительности 